{"dependencies":[{"name":"@babel/runtime/helpers/asyncToGenerator","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"YisBBiy2Xm9DEVdFebZ2nbgAHBo=","exportNames":["*"],"imports":1}},{"name":"../lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":43,"index":43}}],"key":"phU7YuntQKgoAYKWKHVlsIL7LCY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.getQueuePosition = getQueuePosition;\n  exports.getQueueStats = getQueueStats;\n  exports.subscribeToQueuePosition = subscribeToQueuePosition;\n  var _babelRuntimeHelpersAsyncToGenerator = require(_dependencyMap[0], \"@babel/runtime/helpers/asyncToGenerator\");\n  var _asyncToGenerator = _interopDefault(_babelRuntimeHelpersAsyncToGenerator);\n  var _libSupabase = require(_dependencyMap[1], \"../lib/supabase\");\n  /**\n   * Get user's queue position\n   */\n  function getQueuePosition(_x, _x2) {\n    return _getQueuePosition.apply(this, arguments);\n  }\n  /**\n   * Get queue statistics\n   */\n  function _getQueuePosition() {\n    _getQueuePosition = (0, _asyncToGenerator.default)(function* (userId, teamSize) {\n      try {\n        // Get all waiting users for this team size, ordered by join time\n        var _yield$supabase$from$ = yield _libSupabase.supabase.from('matchmaking_queue').select('user_id, joined_at').eq('team_size', teamSize).eq('status', 'waiting').order('joined_at', {\n            ascending: true\n          }),\n          data = _yield$supabase$from$.data,\n          error = _yield$supabase$from$.error;\n        if (error) throw error;\n\n        // Find user's position\n        var position = data?.findIndex(entry => entry.user_id === userId);\n        return position !== undefined && position >= 0 ? position + 1 : null;\n      } catch (error) {\n        console.error('Get queue position error:', error);\n        return null;\n      }\n    });\n    return _getQueuePosition.apply(this, arguments);\n  }\n  function getQueueStats(_x3) {\n    return _getQueueStats.apply(this, arguments);\n  }\n  /**\n   * Subscribe to queue position changes\n   */\n  function _getQueueStats() {\n    _getQueueStats = (0, _asyncToGenerator.default)(function* (teamSize) {\n      try {\n        var _yield$supabase$from$2 = yield _libSupabase.supabase.from('matchmaking_queue').select('*', {\n            count: 'exact',\n            head: true\n          }).eq('team_size', teamSize).eq('status', 'waiting'),\n          count = _yield$supabase$from$2.count,\n          error = _yield$supabase$from$2.error;\n        if (error) throw error;\n\n        // Calculate estimated wait time\n        // Formula: (players in queue / team size) * average match time\n        var playersNeeded = parseInt(teamSize[0]) * 2; // e.g., 1v1 needs 2 players\n        var groupsInQueue = Math.floor((count || 0) / playersNeeded);\n        var estimatedWaitSeconds = groupsInQueue * 30; // 30 seconds per group ahead\n\n        return {\n          playersInQueue: count || 0,\n          groupsAhead: groupsInQueue,\n          estimatedWaitSeconds\n        };\n      } catch (error) {\n        console.error('Get queue stats error:', error);\n        return {\n          playersInQueue: 0,\n          groupsAhead: 0,\n          estimatedWaitSeconds: 0\n        };\n      }\n    });\n    return _getQueueStats.apply(this, arguments);\n  }\n  function subscribeToQueuePosition(userId, teamSize, callback) {\n    // Subscribe to changes in the queue\n    var channel = _libSupabase.supabase.channel(`queue-position:${userId}`).on('postgres_changes', {\n      event: '*',\n      schema: 'public',\n      table: 'matchmaking_queue',\n      filter: `team_size=eq.${teamSize}`\n    }, /*#__PURE__*/(0, _asyncToGenerator.default)(function* () {\n      var position = yield getQueuePosition(userId, teamSize);\n      callback(position);\n    })).subscribe();\n\n    // Initial position\n    getQueuePosition(userId, teamSize).then(callback);\n    return () => {\n      _libSupabase.supabase.removeChannel(channel);\n    };\n  }\n});","lineCount":105,"map":[[12,2,15,0,"exports"],[12,9,15,0],[12,10,15,0,"getQueuePosition"],[12,26,15,0],[12,29,15,0,"getQueuePosition"],[12,45,15,0],[13,2,42,0,"exports"],[13,9,42,0],[13,10,42,0,"getQueueStats"],[13,23,42,0],[13,26,42,0,"getQueueStats"],[13,39,42,0],[14,2,76,0,"exports"],[14,9,76,0],[14,10,76,0,"subscribeToQueuePosition"],[14,34,76,0],[14,37,76,0,"subscribeToQueuePosition"],[14,61,76,0],[15,2,105,1],[15,6,105,1,"_babelRuntimeHelpersAsyncToGenerator"],[15,42,105,1],[15,45,105,1,"require"],[15,52,105,1],[15,53,105,1,"_dependencyMap"],[15,67,105,1],[16,2,105,1],[16,6,105,1,"_asyncToGenerator"],[16,23,105,1],[16,26,105,1,"_interopDefault"],[16,41,105,1],[16,42,105,1,"_babelRuntimeHelpersAsyncToGenerator"],[16,78,105,1],[17,2,1,0],[17,6,1,0,"_libSupabase"],[17,18,1,0],[17,21,1,0,"require"],[17,28,1,0],[17,29,1,0,"_dependencyMap"],[17,43,1,0],[18,2,12,0],[19,0,13,0],[20,0,14,0],[21,2,12,0],[21,11,15,22,"getQueuePosition"],[21,27,15,38,"getQueuePosition"],[21,28,15,38,"_x"],[21,30,15,38],[21,32,15,38,"_x2"],[21,35,15,38],[22,4,15,38],[22,11,15,38,"_getQueuePosition"],[22,28,15,38],[22,29,15,38,"apply"],[22,34,15,38],[22,41,15,38,"arguments"],[22,50,15,38],[23,2,15,38],[24,2,39,0],[25,0,40,0],[26,0,41,0],[27,2,39,0],[27,11,39,0,"_getQueuePosition"],[27,29,39,0],[28,4,39,0,"_getQueuePosition"],[28,21,39,0],[28,28,39,0,"_asyncToGenerator"],[28,45,39,0],[28,46,39,0,"default"],[28,53,39,0],[28,55,15,7],[28,66,16,2,"userId"],[28,72,16,16],[28,74,17,2,"teamSize"],[28,82,17,18],[28,84,18,26],[29,6,19,2],[29,10,19,6],[30,8,20,4],[31,8,21,4],[31,12,21,4,"_yield$supabase$from$"],[31,33,21,4],[31,42,21,34,"supabase"],[31,54,21,42],[31,55,21,42,"supabase"],[31,63,21,42],[31,64,22,7,"from"],[31,68,22,11],[31,69,22,12],[31,88,22,31],[31,89,22,32],[31,90,23,7,"select"],[31,96,23,13],[31,97,23,14],[31,117,23,34],[31,118,23,35],[31,119,24,7,"eq"],[31,121,24,9],[31,122,24,10],[31,133,24,21],[31,135,24,23,"teamSize"],[31,143,24,31],[31,144,24,32],[31,145,25,7,"eq"],[31,147,25,9],[31,148,25,10],[31,156,25,18],[31,158,25,20],[31,167,25,29],[31,168,25,30],[31,169,26,7,"order"],[31,174,26,12],[31,175,26,13],[31,186,26,24],[31,188,26,26],[32,12,26,28,"ascending"],[32,21,26,37],[32,23,26,39],[33,10,26,44],[33,11,26,45],[33,12,26,46],[34,10,21,12,"data"],[34,14,21,16],[34,17,21,16,"_yield$supabase$from$"],[34,38,21,16],[34,39,21,12,"data"],[34,43,21,16],[35,10,21,18,"error"],[35,15,21,23],[35,18,21,23,"_yield$supabase$from$"],[35,39,21,23],[35,40,21,18,"error"],[35,45,21,23],[36,8,28,4],[36,12,28,8,"error"],[36,17,28,13],[36,19,28,15],[36,25,28,21,"error"],[36,30,28,26],[38,8,30,4],[39,8,31,4],[39,12,31,10,"position"],[39,20,31,18],[39,23,31,21,"data"],[39,27,31,25],[39,29,31,27,"findIndex"],[39,38,31,36],[39,39,31,37,"entry"],[39,44,31,42],[39,48,31,46,"entry"],[39,53,31,51],[39,54,31,52,"user_id"],[39,61,31,59],[39,66,31,64,"userId"],[39,72,31,70],[39,73,31,71],[40,8,32,4],[40,15,32,11,"position"],[40,23,32,19],[40,28,32,24,"undefined"],[40,37,32,33],[40,41,32,37,"position"],[40,49,32,45],[40,53,32,49],[40,54,32,50],[40,57,32,53,"position"],[40,65,32,61],[40,68,32,64],[40,69,32,65],[40,72,32,68],[40,76,32,72],[41,6,33,2],[41,7,33,3],[41,8,33,4],[41,15,33,11,"error"],[41,20,33,16],[41,22,33,18],[42,8,34,4,"console"],[42,15,34,11],[42,16,34,12,"error"],[42,21,34,17],[42,22,34,18],[42,49,34,45],[42,51,34,47,"error"],[42,56,34,52],[42,57,34,53],[43,8,35,4],[43,15,35,11],[43,19,35,15],[44,6,36,2],[45,4,37,0],[45,5,37,1],[46,4,37,1],[46,11,37,1,"_getQueuePosition"],[46,28,37,1],[46,29,37,1,"apply"],[46,34,37,1],[46,41,37,1,"arguments"],[46,50,37,1],[47,2,37,1],[48,2,37,1],[48,11,42,22,"getQueueStats"],[48,24,42,35,"getQueueStats"],[48,25,42,35,"_x3"],[48,28,42,35],[49,4,42,35],[49,11,42,35,"_getQueueStats"],[49,25,42,35],[49,26,42,35,"apply"],[49,31,42,35],[49,38,42,35,"arguments"],[49,47,42,35],[50,2,42,35],[51,2,73,0],[52,0,74,0],[53,0,75,0],[54,2,73,0],[54,11,73,0,"_getQueueStats"],[54,26,73,0],[55,4,73,0,"_getQueueStats"],[55,18,73,0],[55,25,73,0,"_asyncToGenerator"],[55,42,73,0],[55,43,73,0,"default"],[55,50,73,0],[55,52,42,7],[55,63,42,36,"teamSize"],[55,71,42,52],[55,73,42,54],[56,6,43,2],[56,10,43,6],[57,8,44,4],[57,12,44,4,"_yield$supabase$from$2"],[57,34,44,4],[57,43,44,35,"supabase"],[57,55,44,43],[57,56,44,43,"supabase"],[57,64,44,43],[57,65,45,7,"from"],[57,69,45,11],[57,70,45,12],[57,89,45,31],[57,90,45,32],[57,91,46,7,"select"],[57,97,46,13],[57,98,46,14],[57,101,46,17],[57,103,46,19],[58,12,46,21,"count"],[58,17,46,26],[58,19,46,28],[58,26,46,35],[59,12,46,37,"head"],[59,16,46,41],[59,18,46,43],[60,10,46,48],[60,11,46,49],[60,12,46,50],[60,13,47,7,"eq"],[60,15,47,9],[60,16,47,10],[60,27,47,21],[60,29,47,23,"teamSize"],[60,37,47,31],[60,38,47,32],[60,39,48,7,"eq"],[60,41,48,9],[60,42,48,10],[60,50,48,18],[60,52,48,20],[60,61,48,29],[60,62,48,30],[61,10,44,12,"count"],[61,15,44,17],[61,18,44,17,"_yield$supabase$from$2"],[61,40,44,17],[61,41,44,12,"count"],[61,46,44,17],[62,10,44,19,"error"],[62,15,44,24],[62,18,44,24,"_yield$supabase$from$2"],[62,40,44,24],[62,41,44,19,"error"],[62,46,44,24],[63,8,50,4],[63,12,50,8,"error"],[63,17,50,13],[63,19,50,15],[63,25,50,21,"error"],[63,30,50,26],[65,8,52,4],[66,8,53,4],[67,8,54,4],[67,12,54,10,"playersNeeded"],[67,25,54,23],[67,28,54,26,"parseInt"],[67,36,54,34],[67,37,54,35,"teamSize"],[67,45,54,43],[67,46,54,44],[67,47,54,45],[67,48,54,46],[67,49,54,47],[67,52,54,50],[67,53,54,51],[67,54,54,52],[67,55,54,53],[68,8,55,4],[68,12,55,10,"groupsInQueue"],[68,25,55,23],[68,28,55,26,"Math"],[68,32,55,30],[68,33,55,31,"floor"],[68,38,55,36],[68,39,55,37],[68,40,55,38,"count"],[68,45,55,43],[68,49,55,47],[68,50,55,48],[68,54,55,52,"playersNeeded"],[68,67,55,65],[68,68,55,66],[69,8,56,4],[69,12,56,10,"estimatedWaitSeconds"],[69,32,56,30],[69,35,56,33,"groupsInQueue"],[69,48,56,46],[69,51,56,49],[69,53,56,51],[69,54,56,52],[69,55,56,53],[71,8,58,4],[71,15,58,11],[72,10,59,6,"playersInQueue"],[72,24,59,20],[72,26,59,22,"count"],[72,31,59,27],[72,35,59,31],[72,36,59,32],[73,10,60,6,"groupsAhead"],[73,21,60,17],[73,23,60,19,"groupsInQueue"],[73,36,60,32],[74,10,61,6,"estimatedWaitSeconds"],[75,8,62,4],[75,9,62,5],[76,6,63,2],[76,7,63,3],[76,8,63,4],[76,15,63,11,"error"],[76,20,63,16],[76,22,63,18],[77,8,64,4,"console"],[77,15,64,11],[77,16,64,12,"error"],[77,21,64,17],[77,22,64,18],[77,46,64,42],[77,48,64,44,"error"],[77,53,64,49],[77,54,64,50],[78,8,65,4],[78,15,65,11],[79,10,66,6,"playersInQueue"],[79,24,66,20],[79,26,66,22],[79,27,66,23],[80,10,67,6,"groupsAhead"],[80,21,67,17],[80,23,67,19],[80,24,67,20],[81,10,68,6,"estimatedWaitSeconds"],[81,30,68,26],[81,32,68,28],[82,8,69,4],[82,9,69,5],[83,6,70,2],[84,4,71,0],[84,5,71,1],[85,4,71,1],[85,11,71,1,"_getQueueStats"],[85,25,71,1],[85,26,71,1,"apply"],[85,31,71,1],[85,38,71,1,"arguments"],[85,47,71,1],[86,2,71,1],[87,2,76,7],[87,11,76,16,"subscribeToQueuePosition"],[87,35,76,40,"subscribeToQueuePosition"],[87,36,77,2,"userId"],[87,42,77,16],[87,44,78,2,"teamSize"],[87,52,78,18],[87,54,79,2,"callback"],[87,62,79,45],[87,64,80,2],[88,4,81,2],[89,4,82,2],[89,8,82,8,"channel"],[89,15,82,15],[89,18,82,18,"supabase"],[89,30,82,26],[89,31,82,26,"supabase"],[89,39,82,26],[89,40,83,5,"channel"],[89,47,83,12],[89,48,83,13],[89,66,83,31,"userId"],[89,72,83,37],[89,74,83,39],[89,75,83,40],[89,76,84,5,"on"],[89,78,84,7],[89,79,85,6],[89,97,85,24],[89,99,86,6],[90,6,87,8,"event"],[90,11,87,13],[90,13,87,15],[90,16,87,18],[91,6,88,8,"schema"],[91,12,88,14],[91,14,88,16],[91,22,88,24],[92,6,89,8,"table"],[92,11,89,13],[92,13,89,15],[92,32,89,34],[93,6,90,8,"filter"],[93,12,90,14],[93,14,90,16],[93,30,90,32,"teamSize"],[93,38,90,40],[94,4,91,6],[94,5,91,7],[94,24,91,7,"_asyncToGenerator"],[94,41,91,7],[94,42,91,7,"default"],[94,49,91,7],[94,51,92,6],[94,64,92,18],[95,6,93,8],[95,10,93,14,"position"],[95,18,93,22],[95,27,93,31,"getQueuePosition"],[95,43,93,47],[95,44,93,48,"userId"],[95,50,93,54],[95,52,93,56,"teamSize"],[95,60,93,64],[95,61,93,65],[96,6,94,8,"callback"],[96,14,94,16],[96,15,94,17,"position"],[96,23,94,25],[96,24,94,26],[97,4,95,6],[97,5,95,7],[97,6,96,4],[97,7,96,5],[97,8,97,5,"subscribe"],[97,17,97,14],[97,18,97,15],[97,19,97,16],[99,4,99,2],[100,4,100,2,"getQueuePosition"],[100,20,100,18],[100,21,100,19,"userId"],[100,27,100,25],[100,29,100,27,"teamSize"],[100,37,100,35],[100,38,100,36],[100,39,100,37,"then"],[100,43,100,41],[100,44,100,42,"callback"],[100,52,100,50],[100,53,100,51],[101,4,102,2],[101,11,102,9],[101,17,102,15],[102,6,103,4,"supabase"],[102,18,103,12],[102,19,103,12,"supabase"],[102,27,103,12],[102,28,103,13,"removeChannel"],[102,41,103,26],[102,42,103,27,"channel"],[102,49,103,34],[102,50,103,35],[103,4,104,2],[103,5,104,3],[104,2,105,0],[105,0,105,1],[105,3]],"functionMap":{"names":["<global>","getQueuePosition","data.findIndex$argument_0","getQueueStats","subscribeToQueuePosition","supabase.channel.on$argument_2","<anonymous>"],"mappings":"AAA;OCc;qCCgB,iCD;CDM;OGK;CH6B;OIK;MCgB;ODG;SEO;GFE;CJC"},"hasCjsExports":false},"type":"js/module"}]}