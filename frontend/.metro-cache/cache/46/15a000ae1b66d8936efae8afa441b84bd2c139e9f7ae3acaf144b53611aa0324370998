{"dependencies":[{"name":"../lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":43,"index":43}}],"key":"phU7YuntQKgoAYKWKHVlsIL7LCY=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getQueuePosition = getQueuePosition;\n  exports.getQueueStats = getQueueStats;\n  exports.subscribeToQueuePosition = subscribeToQueuePosition;\n  var _libSupabase = require(_dependencyMap[0], \"../lib/supabase\");\n  /**\n   * Get user's queue position\n   */\n  async function getQueuePosition(userId, teamSize) {\n    try {\n      // Get all waiting users for this team size, ordered by join time\n      const {\n        data,\n        error\n      } = await _libSupabase.supabase.from('matchmaking_queue').select('user_id, joined_at').eq('team_size', teamSize).eq('status', 'waiting').order('joined_at', {\n        ascending: true\n      });\n      if (error) throw error;\n\n      // Find user's position\n      const position = data?.findIndex(entry => entry.user_id === userId);\n      return position !== undefined && position >= 0 ? position + 1 : null;\n    } catch (error) {\n      console.error('Get queue position error:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Get queue statistics\n   */\n  async function getQueueStats(teamSize) {\n    try {\n      const {\n        count,\n        error\n      } = await _libSupabase.supabase.from('matchmaking_queue').select('*', {\n        count: 'exact',\n        head: true\n      }).eq('team_size', teamSize).eq('status', 'waiting');\n      if (error) throw error;\n\n      // Calculate estimated wait time\n      // Formula: (players in queue / team size) * average match time\n      const playersNeeded = parseInt(teamSize[0]) * 2; // e.g., 1v1 needs 2 players\n      const groupsInQueue = Math.floor((count || 0) / playersNeeded);\n      const estimatedWaitSeconds = groupsInQueue * 30; // 30 seconds per group ahead\n\n      return {\n        playersInQueue: count || 0,\n        groupsAhead: groupsInQueue,\n        estimatedWaitSeconds\n      };\n    } catch (error) {\n      console.error('Get queue stats error:', error);\n      return {\n        playersInQueue: 0,\n        groupsAhead: 0,\n        estimatedWaitSeconds: 0\n      };\n    }\n  }\n\n  /**\n   * Subscribe to queue position changes\n   */\n  function subscribeToQueuePosition(userId, teamSize, callback) {\n    // Subscribe to changes in the queue\n    const channel = _libSupabase.supabase.channel(`queue-position:${userId}`).on('postgres_changes', {\n      event: '*',\n      schema: 'public',\n      table: 'matchmaking_queue',\n      filter: `team_size=eq.${teamSize}`\n    }, async () => {\n      const position = await getQueuePosition(userId, teamSize);\n      callback(position);\n    }).subscribe();\n\n    // Initial position\n    getQueuePosition(userId, teamSize).then(callback);\n    return () => {\n      _libSupabase.supabase.removeChannel(channel);\n    };\n  }\n});","lineCount":90,"map":[[7,2,15,0,"exports"],[7,9,15,0],[7,10,15,0,"getQueuePosition"],[7,26,15,0],[7,29,15,0,"getQueuePosition"],[7,45,15,0],[8,2,42,0,"exports"],[8,9,42,0],[8,10,42,0,"getQueueStats"],[8,23,42,0],[8,26,42,0,"getQueueStats"],[8,39,42,0],[9,2,76,0,"exports"],[9,9,76,0],[9,10,76,0,"subscribeToQueuePosition"],[9,34,76,0],[9,37,76,0,"subscribeToQueuePosition"],[9,61,76,0],[10,2,1,0],[10,6,1,0,"_libSupabase"],[10,18,1,0],[10,21,1,0,"require"],[10,28,1,0],[10,29,1,0,"_dependencyMap"],[10,43,1,0],[11,2,12,0],[12,0,13,0],[13,0,14,0],[14,2,15,7],[14,17,15,22,"getQueuePosition"],[14,33,15,38,"getQueuePosition"],[14,34,16,2,"userId"],[14,40,16,16],[14,42,17,2,"teamSize"],[14,50,17,18],[14,52,18,26],[15,4,19,2],[15,8,19,6],[16,6,20,4],[17,6,21,4],[17,12,21,10],[18,8,21,12,"data"],[18,12,21,16],[19,8,21,18,"error"],[20,6,21,24],[20,7,21,25],[20,10,21,28],[20,16,21,34,"supabase"],[20,28,21,42],[20,29,21,42,"supabase"],[20,37,21,42],[20,38,22,7,"from"],[20,42,22,11],[20,43,22,12],[20,62,22,31],[20,63,22,32],[20,64,23,7,"select"],[20,70,23,13],[20,71,23,14],[20,91,23,34],[20,92,23,35],[20,93,24,7,"eq"],[20,95,24,9],[20,96,24,10],[20,107,24,21],[20,109,24,23,"teamSize"],[20,117,24,31],[20,118,24,32],[20,119,25,7,"eq"],[20,121,25,9],[20,122,25,10],[20,130,25,18],[20,132,25,20],[20,141,25,29],[20,142,25,30],[20,143,26,7,"order"],[20,148,26,12],[20,149,26,13],[20,160,26,24],[20,162,26,26],[21,8,26,28,"ascending"],[21,17,26,37],[21,19,26,39],[22,6,26,44],[22,7,26,45],[22,8,26,46],[23,6,28,4],[23,10,28,8,"error"],[23,15,28,13],[23,17,28,15],[23,23,28,21,"error"],[23,28,28,26],[25,6,30,4],[26,6,31,4],[26,12,31,10,"position"],[26,20,31,18],[26,23,31,21,"data"],[26,27,31,25],[26,29,31,27,"findIndex"],[26,38,31,36],[26,39,31,37,"entry"],[26,44,31,42],[26,48,31,46,"entry"],[26,53,31,51],[26,54,31,52,"user_id"],[26,61,31,59],[26,66,31,64,"userId"],[26,72,31,70],[26,73,31,71],[27,6,32,4],[27,13,32,11,"position"],[27,21,32,19],[27,26,32,24,"undefined"],[27,35,32,33],[27,39,32,37,"position"],[27,47,32,45],[27,51,32,49],[27,52,32,50],[27,55,32,53,"position"],[27,63,32,61],[27,66,32,64],[27,67,32,65],[27,70,32,68],[27,74,32,72],[28,4,33,2],[28,5,33,3],[28,6,33,4],[28,13,33,11,"error"],[28,18,33,16],[28,20,33,18],[29,6,34,4,"console"],[29,13,34,11],[29,14,34,12,"error"],[29,19,34,17],[29,20,34,18],[29,47,34,45],[29,49,34,47,"error"],[29,54,34,52],[29,55,34,53],[30,6,35,4],[30,13,35,11],[30,17,35,15],[31,4,36,2],[32,2,37,0],[34,2,39,0],[35,0,40,0],[36,0,41,0],[37,2,42,7],[37,17,42,22,"getQueueStats"],[37,30,42,35,"getQueueStats"],[37,31,42,36,"teamSize"],[37,39,42,52],[37,41,42,54],[38,4,43,2],[38,8,43,6],[39,6,44,4],[39,12,44,10],[40,8,44,12,"count"],[40,13,44,17],[41,8,44,19,"error"],[42,6,44,25],[42,7,44,26],[42,10,44,29],[42,16,44,35,"supabase"],[42,28,44,43],[42,29,44,43,"supabase"],[42,37,44,43],[42,38,45,7,"from"],[42,42,45,11],[42,43,45,12],[42,62,45,31],[42,63,45,32],[42,64,46,7,"select"],[42,70,46,13],[42,71,46,14],[42,74,46,17],[42,76,46,19],[43,8,46,21,"count"],[43,13,46,26],[43,15,46,28],[43,22,46,35],[44,8,46,37,"head"],[44,12,46,41],[44,14,46,43],[45,6,46,48],[45,7,46,49],[45,8,46,50],[45,9,47,7,"eq"],[45,11,47,9],[45,12,47,10],[45,23,47,21],[45,25,47,23,"teamSize"],[45,33,47,31],[45,34,47,32],[45,35,48,7,"eq"],[45,37,48,9],[45,38,48,10],[45,46,48,18],[45,48,48,20],[45,57,48,29],[45,58,48,30],[46,6,50,4],[46,10,50,8,"error"],[46,15,50,13],[46,17,50,15],[46,23,50,21,"error"],[46,28,50,26],[48,6,52,4],[49,6,53,4],[50,6,54,4],[50,12,54,10,"playersNeeded"],[50,25,54,23],[50,28,54,26,"parseInt"],[50,36,54,34],[50,37,54,35,"teamSize"],[50,45,54,43],[50,46,54,44],[50,47,54,45],[50,48,54,46],[50,49,54,47],[50,52,54,50],[50,53,54,51],[50,54,54,52],[50,55,54,53],[51,6,55,4],[51,12,55,10,"groupsInQueue"],[51,25,55,23],[51,28,55,26,"Math"],[51,32,55,30],[51,33,55,31,"floor"],[51,38,55,36],[51,39,55,37],[51,40,55,38,"count"],[51,45,55,43],[51,49,55,47],[51,50,55,48],[51,54,55,52,"playersNeeded"],[51,67,55,65],[51,68,55,66],[52,6,56,4],[52,12,56,10,"estimatedWaitSeconds"],[52,32,56,30],[52,35,56,33,"groupsInQueue"],[52,48,56,46],[52,51,56,49],[52,53,56,51],[52,54,56,52],[52,55,56,53],[54,6,58,4],[54,13,58,11],[55,8,59,6,"playersInQueue"],[55,22,59,20],[55,24,59,22,"count"],[55,29,59,27],[55,33,59,31],[55,34,59,32],[56,8,60,6,"groupsAhead"],[56,19,60,17],[56,21,60,19,"groupsInQueue"],[56,34,60,32],[57,8,61,6,"estimatedWaitSeconds"],[58,6,62,4],[58,7,62,5],[59,4,63,2],[59,5,63,3],[59,6,63,4],[59,13,63,11,"error"],[59,18,63,16],[59,20,63,18],[60,6,64,4,"console"],[60,13,64,11],[60,14,64,12,"error"],[60,19,64,17],[60,20,64,18],[60,44,64,42],[60,46,64,44,"error"],[60,51,64,49],[60,52,64,50],[61,6,65,4],[61,13,65,11],[62,8,66,6,"playersInQueue"],[62,22,66,20],[62,24,66,22],[62,25,66,23],[63,8,67,6,"groupsAhead"],[63,19,67,17],[63,21,67,19],[63,22,67,20],[64,8,68,6,"estimatedWaitSeconds"],[64,28,68,26],[64,30,68,28],[65,6,69,4],[65,7,69,5],[66,4,70,2],[67,2,71,0],[69,2,73,0],[70,0,74,0],[71,0,75,0],[72,2,76,7],[72,11,76,16,"subscribeToQueuePosition"],[72,35,76,40,"subscribeToQueuePosition"],[72,36,77,2,"userId"],[72,42,77,16],[72,44,78,2,"teamSize"],[72,52,78,18],[72,54,79,2,"callback"],[72,62,79,45],[72,64,80,2],[73,4,81,2],[74,4,82,2],[74,10,82,8,"channel"],[74,17,82,15],[74,20,82,18,"supabase"],[74,32,82,26],[74,33,82,26,"supabase"],[74,41,82,26],[74,42,83,5,"channel"],[74,49,83,12],[74,50,83,13],[74,68,83,31,"userId"],[74,74,83,37],[74,76,83,39],[74,77,83,40],[74,78,84,5,"on"],[74,80,84,7],[74,81,85,6],[74,99,85,24],[74,101,86,6],[75,6,87,8,"event"],[75,11,87,13],[75,13,87,15],[75,16,87,18],[76,6,88,8,"schema"],[76,12,88,14],[76,14,88,16],[76,22,88,24],[77,6,89,8,"table"],[77,11,89,13],[77,13,89,15],[77,32,89,34],[78,6,90,8,"filter"],[78,12,90,14],[78,14,90,16],[78,30,90,32,"teamSize"],[78,38,90,40],[79,4,91,6],[79,5,91,7],[79,7,92,6],[79,19,92,18],[80,6,93,8],[80,12,93,14,"position"],[80,20,93,22],[80,23,93,25],[80,29,93,31,"getQueuePosition"],[80,45,93,47],[80,46,93,48,"userId"],[80,52,93,54],[80,54,93,56,"teamSize"],[80,62,93,64],[80,63,93,65],[81,6,94,8,"callback"],[81,14,94,16],[81,15,94,17,"position"],[81,23,94,25],[81,24,94,26],[82,4,95,6],[82,5,96,4],[82,6,96,5],[82,7,97,5,"subscribe"],[82,16,97,14],[82,17,97,15],[82,18,97,16],[84,4,99,2],[85,4,100,2,"getQueuePosition"],[85,20,100,18],[85,21,100,19,"userId"],[85,27,100,25],[85,29,100,27,"teamSize"],[85,37,100,35],[85,38,100,36],[85,39,100,37,"then"],[85,43,100,41],[85,44,100,42,"callback"],[85,52,100,50],[85,53,100,51],[86,4,102,2],[86,11,102,9],[86,17,102,15],[87,6,103,4,"supabase"],[87,18,103,12],[87,19,103,12,"supabase"],[87,27,103,12],[87,28,103,13,"removeChannel"],[87,41,103,26],[87,42,103,27,"channel"],[87,49,103,34],[87,50,103,35],[88,4,104,2],[88,5,104,3],[89,2,105,0],[90,0,105,1],[90,3]],"functionMap":{"names":["<global>","getQueuePosition","data.findIndex$argument_0","getQueueStats","subscribeToQueuePosition","supabase.channel.on$argument_2","<anonymous>"],"mappings":"AAA;OCc;qCCgB,iCD;CDM;OGK;CH6B;OIK;MCgB;ODG;SEO;GFE;CJC"},"hasCjsExports":false},"type":"js/module"}]}