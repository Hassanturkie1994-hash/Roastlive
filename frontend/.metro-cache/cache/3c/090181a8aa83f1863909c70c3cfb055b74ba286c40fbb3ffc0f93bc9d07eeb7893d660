{"dependencies":[{"name":"../lib/supabase","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":43,"index":43}}],"key":"phU7YuntQKgoAYKWKHVlsIL7LCY=","exportNames":["*"],"imports":1}},{"name":"react-native-web/dist/exports/AppState","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"JfCM6WRyn2619+pzBJhEHd1+SSw=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  function _interopDefault(e) {\n    return e && e.__esModule ? e : {\n      default: e\n    };\n  }\n  exports.initializeStreamMonitoring = initializeStreamMonitoring;\n  exports.getPauseStatus = getPauseStatus;\n  var _libSupabase = require(_dependencyMap[0], \"../lib/supabase\");\n  var _reactNativeWebDistExportsAppState = require(_dependencyMap[1], \"react-native-web/dist/exports/AppState\");\n  var AppState = _interopDefault(_reactNativeWebDistExportsAppState);\n  let pauseState = null;\n  const PAUSE_TIMEOUT_MS = 10 * 60 * 1000; // 10 minutes\n\n  /**\n   * Initialize stream pause/resume monitoring\n   * Call this when a stream starts\n   */\n  function initializeStreamMonitoring(streamId, onAutoEnd) {\n    let appStateSubscription;\n    const handleAppStateChange = async nextAppState => {\n      console.log('AppState changed to:', nextAppState);\n      if (nextAppState === 'background' || nextAppState === 'inactive') {\n        // App went to background - pause stream\n        await pauseStream(streamId, onAutoEnd);\n      } else if (nextAppState === 'active') {\n        // App came to foreground - resume stream\n        await resumeStream(streamId);\n      }\n    };\n\n    // Subscribe to app state changes\n    appStateSubscription = AppState.default.addEventListener('change', handleAppStateChange);\n\n    // Cleanup function\n    return () => {\n      if (appStateSubscription) {\n        appStateSubscription.remove();\n      }\n      if (pauseState?.timeoutId) {\n        clearTimeout(pauseState.timeoutId);\n      }\n      pauseState = null;\n    };\n  }\n\n  /**\n   * Pause a stream (called when app goes to background)\n   */\n  async function pauseStream(streamId, onAutoEnd) {\n    if (pauseState) return; // Already paused\n\n    console.log('⏸️ Pausing stream:', streamId);\n    try {\n      // Update stream status to paused\n      await _libSupabase.supabase.from('streams').update({\n        is_paused: true,\n        paused_at: new Date().toISOString()\n      }).eq('id', streamId);\n\n      // Set 10-minute timeout\n      const timeoutId = setTimeout(async () => {\n        console.log('⏰ 10-minute pause timeout reached - ending stream');\n        await endStreamDueToPause(streamId);\n        onAutoEnd();\n      }, PAUSE_TIMEOUT_MS);\n      pauseState = {\n        streamId,\n        pausedAt: Date.now(),\n        timeoutId\n      };\n    } catch (error) {\n      console.error('Pause stream error:', error);\n    }\n  }\n\n  /**\n   * Resume a stream (called when app returns to foreground)\n   */\n  async function resumeStream(streamId) {\n    if (!pauseState || pauseState.streamId !== streamId) return;\n    console.log('▶️ Resuming stream:', streamId);\n    try {\n      // Clear timeout\n      if (pauseState.timeoutId) {\n        clearTimeout(pauseState.timeoutId);\n      }\n\n      // Check if we're within 10-minute window\n      const pauseDuration = Date.now() - pauseState.pausedAt;\n      if (pauseDuration >= PAUSE_TIMEOUT_MS) {\n        // Too late, stream should have ended\n        console.log('❌ Cannot resume - pause timeout exceeded');\n        return;\n      }\n\n      // Update stream status to active\n      await _libSupabase.supabase.from('streams').update({\n        is_paused: false,\n        resumed_at: new Date().toISOString()\n      }).eq('id', streamId);\n      pauseState = null;\n    } catch (error) {\n      console.error('Resume stream error:', error);\n    }\n  }\n\n  /**\n   * End a stream due to pause timeout\n   */\n  async function endStreamDueToPause(streamId) {\n    try {\n      await _libSupabase.supabase.from('streams').update({\n        is_live: false,\n        is_paused: false,\n        ended_at: new Date().toISOString(),\n        end_reason: 'paused_timeout'\n      }).eq('id', streamId);\n\n      // Add system message to chat\n      await _libSupabase.supabase.from('stream_messages').insert({\n        stream_id: streamId,\n        user_id: null,\n        username: 'System',\n        message: 'Stream ended due to inactivity (10 minutes)',\n        type: 'system'\n      });\n      pauseState = null;\n    } catch (error) {\n      console.error('End stream due to pause error:', error);\n    }\n  }\n\n  /**\n   * Get pause status\n   */\n  function getPauseStatus() {\n    if (!pauseState) return null;\n    const elapsed = Date.now() - pauseState.pausedAt;\n    const remaining = PAUSE_TIMEOUT_MS - elapsed;\n    return {\n      isPaused: true,\n      elapsedMs: elapsed,\n      remainingMs: Math.max(0, remaining),\n      remainingMinutes: Math.ceil(remaining / 60000)\n    };\n  }\n});","lineCount":153,"map":[[12,2,17,0,"exports"],[12,9,17,0],[12,10,17,0,"initializeStreamMonitoring"],[12,36,17,0],[12,39,17,0,"initializeStreamMonitoring"],[12,65,17,0],[13,2,157,0,"exports"],[13,9,157,0],[13,10,157,0,"getPauseStatus"],[13,24,157,0],[13,27,157,0,"getPauseStatus"],[13,41,157,0],[14,2,1,0],[14,6,1,0,"_libSupabase"],[14,18,1,0],[14,21,1,0,"require"],[14,28,1,0],[14,29,1,0,"_dependencyMap"],[14,43,1,0],[15,2,1,43],[15,6,1,43,"_reactNativeWebDistExportsAppState"],[15,40,1,43],[15,43,1,43,"require"],[15,50,1,43],[15,51,1,43,"_dependencyMap"],[15,65,1,43],[16,2,1,43],[16,6,1,43,"AppState"],[16,14,1,43],[16,17,1,43,"_interopDefault"],[16,32,1,43],[16,33,1,43,"_reactNativeWebDistExportsAppState"],[16,67,1,43],[17,2,10,0],[17,6,10,4,"pauseState"],[17,16,10,39],[17,19,10,42],[17,23,10,46],[18,2,11,0],[18,8,11,6,"PAUSE_TIMEOUT_MS"],[18,24,11,22],[18,27,11,25],[18,29,11,27],[18,32,11,30],[18,34,11,32],[18,37,11,35],[18,41,11,39],[18,42,11,40],[18,43,11,41],[20,2,13,0],[21,0,14,0],[22,0,15,0],[23,0,16,0],[24,2,17,7],[24,11,17,16,"initializeStreamMonitoring"],[24,37,17,42,"initializeStreamMonitoring"],[24,38,18,2,"streamId"],[24,46,18,18],[24,48,19,2,"onAutoEnd"],[24,57,19,23],[24,59,20,14],[25,4,21,2],[25,8,21,6,"appStateSubscription"],[25,28,21,31],[26,4,23,2],[26,10,23,8,"handleAppStateChange"],[26,30,23,28],[26,33,23,31],[26,39,23,38,"nextAppState"],[26,51,23,66],[26,55,23,71],[27,6,24,4,"console"],[27,13,24,11],[27,14,24,12,"log"],[27,17,24,15],[27,18,24,16],[27,40,24,38],[27,42,24,40,"nextAppState"],[27,54,24,52],[27,55,24,53],[28,6,26,4],[28,10,26,8,"nextAppState"],[28,22,26,20],[28,27,26,25],[28,39,26,37],[28,43,26,41,"nextAppState"],[28,55,26,53],[28,60,26,58],[28,70,26,68],[28,72,26,70],[29,8,27,6],[30,8,28,6],[30,14,28,12,"pauseStream"],[30,25,28,23],[30,26,28,24,"streamId"],[30,34,28,32],[30,36,28,34,"onAutoEnd"],[30,45,28,43],[30,46,28,44],[31,6,29,4],[31,7,29,5],[31,13,29,11],[31,17,29,15,"nextAppState"],[31,29,29,27],[31,34,29,32],[31,42,29,40],[31,44,29,42],[32,8,30,6],[33,8,31,6],[33,14,31,12,"resumeStream"],[33,26,31,24],[33,27,31,25,"streamId"],[33,35,31,33],[33,36,31,34],[34,6,32,4],[35,4,33,2],[35,5,33,3],[37,4,35,2],[38,4,36,2,"appStateSubscription"],[38,24,36,22],[38,27,36,25,"AppState"],[38,35,36,33],[38,36,36,33,"default"],[38,43,36,33],[38,44,36,34,"addEventListener"],[38,60,36,50],[38,61,36,51],[38,69,36,59],[38,71,36,61,"handleAppStateChange"],[38,91,36,81],[38,92,36,82],[40,4,38,2],[41,4,39,2],[41,11,39,9],[41,17,39,15],[42,6,40,4],[42,10,40,8,"appStateSubscription"],[42,30,40,28],[42,32,40,30],[43,8,41,6,"appStateSubscription"],[43,28,41,26],[43,29,41,27,"remove"],[43,35,41,33],[43,36,41,34],[43,37,41,35],[44,6,42,4],[45,6,43,4],[45,10,43,8,"pauseState"],[45,20,43,18],[45,22,43,20,"timeoutId"],[45,31,43,29],[45,33,43,31],[46,8,44,6,"clearTimeout"],[46,20,44,18],[46,21,44,19,"pauseState"],[46,31,44,29],[46,32,44,30,"timeoutId"],[46,41,44,39],[46,42,44,40],[47,6,45,4],[48,6,46,4,"pauseState"],[48,16,46,14],[48,19,46,17],[48,23,46,21],[49,4,47,2],[49,5,47,3],[50,2,48,0],[52,2,50,0],[53,0,51,0],[54,0,52,0],[55,2,53,0],[55,17,53,15,"pauseStream"],[55,28,53,26,"pauseStream"],[55,29,53,27,"streamId"],[55,37,53,43],[55,39,53,45,"onAutoEnd"],[55,48,53,66],[55,50,53,68],[56,4,54,2],[56,8,54,6,"pauseState"],[56,18,54,16],[56,20,54,18],[56,27,54,25],[56,28,54,26],[58,4,56,2,"console"],[58,11,56,9],[58,12,56,10,"log"],[58,15,56,13],[58,16,56,14],[58,36,56,34],[58,38,56,36,"streamId"],[58,46,56,44],[58,47,56,45],[59,4,58,2],[59,8,58,6],[60,6,59,4],[61,6,60,4],[61,12,60,10,"supabase"],[61,24,60,18],[61,25,60,18,"supabase"],[61,33,60,18],[61,34,61,7,"from"],[61,38,61,11],[61,39,61,12],[61,48,61,21],[61,49,61,22],[61,50,62,7,"update"],[61,56,62,13],[61,57,62,14],[62,8,63,8,"is_paused"],[62,17,63,17],[62,19,63,19],[62,23,63,23],[63,8,64,8,"paused_at"],[63,17,64,17],[63,19,64,19],[63,23,64,23,"Date"],[63,27,64,27],[63,28,64,28],[63,29,64,29],[63,30,64,30,"toISOString"],[63,41,64,41],[63,42,64,42],[64,6,65,6],[64,7,65,7],[64,8,65,8],[64,9,66,7,"eq"],[64,11,66,9],[64,12,66,10],[64,16,66,14],[64,18,66,16,"streamId"],[64,26,66,24],[64,27,66,25],[66,6,68,4],[67,6,69,4],[67,12,69,10,"timeoutId"],[67,21,69,19],[67,24,69,22,"setTimeout"],[67,34,69,32],[67,35,69,33],[67,47,69,45],[68,8,70,6,"console"],[68,15,70,13],[68,16,70,14,"log"],[68,19,70,17],[68,20,70,18],[68,71,70,69],[68,72,70,70],[69,8,71,6],[69,14,71,12,"endStreamDueToPause"],[69,33,71,31],[69,34,71,32,"streamId"],[69,42,71,40],[69,43,71,41],[70,8,72,6,"onAutoEnd"],[70,17,72,15],[70,18,72,16],[70,19,72,17],[71,6,73,4],[71,7,73,5],[71,9,73,7,"PAUSE_TIMEOUT_MS"],[71,25,73,23],[71,26,73,24],[72,6,75,4,"pauseState"],[72,16,75,14],[72,19,75,17],[73,8,76,6,"streamId"],[73,16,76,14],[74,8,77,6,"pausedAt"],[74,16,77,14],[74,18,77,16,"Date"],[74,22,77,20],[74,23,77,21,"now"],[74,26,77,24],[74,27,77,25],[74,28,77,26],[75,8,78,6,"timeoutId"],[76,6,79,4],[76,7,79,5],[77,4,80,2],[77,5,80,3],[77,6,80,4],[77,13,80,11,"error"],[77,18,80,16],[77,20,80,18],[78,6,81,4,"console"],[78,13,81,11],[78,14,81,12,"error"],[78,19,81,17],[78,20,81,18],[78,41,81,39],[78,43,81,41,"error"],[78,48,81,46],[78,49,81,47],[79,4,82,2],[80,2,83,0],[82,2,85,0],[83,0,86,0],[84,0,87,0],[85,2,88,0],[85,17,88,15,"resumeStream"],[85,29,88,27,"resumeStream"],[85,30,88,28,"streamId"],[85,38,88,44],[85,40,88,46],[86,4,89,2],[86,8,89,6],[86,9,89,7,"pauseState"],[86,19,89,17],[86,23,89,21,"pauseState"],[86,33,89,31],[86,34,89,32,"streamId"],[86,42,89,40],[86,47,89,45,"streamId"],[86,55,89,53],[86,57,89,55],[87,4,91,2,"console"],[87,11,91,9],[87,12,91,10,"log"],[87,15,91,13],[87,16,91,14],[87,37,91,35],[87,39,91,37,"streamId"],[87,47,91,45],[87,48,91,46],[88,4,93,2],[88,8,93,6],[89,6,94,4],[90,6,95,4],[90,10,95,8,"pauseState"],[90,20,95,18],[90,21,95,19,"timeoutId"],[90,30,95,28],[90,32,95,30],[91,8,96,6,"clearTimeout"],[91,20,96,18],[91,21,96,19,"pauseState"],[91,31,96,29],[91,32,96,30,"timeoutId"],[91,41,96,39],[91,42,96,40],[92,6,97,4],[94,6,99,4],[95,6,100,4],[95,12,100,10,"pauseDuration"],[95,25,100,23],[95,28,100,26,"Date"],[95,32,100,30],[95,33,100,31,"now"],[95,36,100,34],[95,37,100,35],[95,38,100,36],[95,41,100,39,"pauseState"],[95,51,100,49],[95,52,100,50,"pausedAt"],[95,60,100,58],[96,6,101,4],[96,10,101,8,"pauseDuration"],[96,23,101,21],[96,27,101,25,"PAUSE_TIMEOUT_MS"],[96,43,101,41],[96,45,101,43],[97,8,102,6],[98,8,103,6,"console"],[98,15,103,13],[98,16,103,14,"log"],[98,19,103,17],[98,20,103,18],[98,62,103,60],[98,63,103,61],[99,8,104,6],[100,6,105,4],[102,6,107,4],[103,6,108,4],[103,12,108,10,"supabase"],[103,24,108,18],[103,25,108,18,"supabase"],[103,33,108,18],[103,34,109,7,"from"],[103,38,109,11],[103,39,109,12],[103,48,109,21],[103,49,109,22],[103,50,110,7,"update"],[103,56,110,13],[103,57,110,14],[104,8,111,8,"is_paused"],[104,17,111,17],[104,19,111,19],[104,24,111,24],[105,8,112,8,"resumed_at"],[105,18,112,18],[105,20,112,20],[105,24,112,24,"Date"],[105,28,112,28],[105,29,112,29],[105,30,112,30],[105,31,112,31,"toISOString"],[105,42,112,42],[105,43,112,43],[106,6,113,6],[106,7,113,7],[106,8,113,8],[106,9,114,7,"eq"],[106,11,114,9],[106,12,114,10],[106,16,114,14],[106,18,114,16,"streamId"],[106,26,114,24],[106,27,114,25],[107,6,116,4,"pauseState"],[107,16,116,14],[107,19,116,17],[107,23,116,21],[108,4,117,2],[108,5,117,3],[108,6,117,4],[108,13,117,11,"error"],[108,18,117,16],[108,20,117,18],[109,6,118,4,"console"],[109,13,118,11],[109,14,118,12,"error"],[109,19,118,17],[109,20,118,18],[109,42,118,40],[109,44,118,42,"error"],[109,49,118,47],[109,50,118,48],[110,4,119,2],[111,2,120,0],[113,2,122,0],[114,0,123,0],[115,0,124,0],[116,2,125,0],[116,17,125,15,"endStreamDueToPause"],[116,36,125,34,"endStreamDueToPause"],[116,37,125,35,"streamId"],[116,45,125,51],[116,47,125,53],[117,4,126,2],[117,8,126,6],[118,6,127,4],[118,12,127,10,"supabase"],[118,24,127,18],[118,25,127,18,"supabase"],[118,33,127,18],[118,34,128,7,"from"],[118,38,128,11],[118,39,128,12],[118,48,128,21],[118,49,128,22],[118,50,129,7,"update"],[118,56,129,13],[118,57,129,14],[119,8,130,8,"is_live"],[119,15,130,15],[119,17,130,17],[119,22,130,22],[120,8,131,8,"is_paused"],[120,17,131,17],[120,19,131,19],[120,24,131,24],[121,8,132,8,"ended_at"],[121,16,132,16],[121,18,132,18],[121,22,132,22,"Date"],[121,26,132,26],[121,27,132,27],[121,28,132,28],[121,29,132,29,"toISOString"],[121,40,132,40],[121,41,132,41],[121,42,132,42],[122,8,133,8,"end_reason"],[122,18,133,18],[122,20,133,20],[123,6,134,6],[123,7,134,7],[123,8,134,8],[123,9,135,7,"eq"],[123,11,135,9],[123,12,135,10],[123,16,135,14],[123,18,135,16,"streamId"],[123,26,135,24],[123,27,135,25],[125,6,137,4],[126,6,138,4],[126,12,138,10,"supabase"],[126,24,138,18],[126,25,138,18,"supabase"],[126,33,138,18],[126,34,139,7,"from"],[126,38,139,11],[126,39,139,12],[126,56,139,29],[126,57,139,30],[126,58,140,7,"insert"],[126,64,140,13],[126,65,140,14],[127,8,141,8,"stream_id"],[127,17,141,17],[127,19,141,19,"streamId"],[127,27,141,27],[128,8,142,8,"user_id"],[128,15,142,15],[128,17,142,17],[128,21,142,21],[129,8,143,8,"username"],[129,16,143,16],[129,18,143,18],[129,26,143,26],[130,8,144,8,"message"],[130,15,144,15],[130,17,144,17],[130,62,144,62],[131,8,145,8,"type"],[131,12,145,12],[131,14,145,14],[132,6,146,6],[132,7,146,7],[132,8,146,8],[133,6,148,4,"pauseState"],[133,16,148,14],[133,19,148,17],[133,23,148,21],[134,4,149,2],[134,5,149,3],[134,6,149,4],[134,13,149,11,"error"],[134,18,149,16],[134,20,149,18],[135,6,150,4,"console"],[135,13,150,11],[135,14,150,12,"error"],[135,19,150,17],[135,20,150,18],[135,52,150,50],[135,54,150,52,"error"],[135,59,150,57],[135,60,150,58],[136,4,151,2],[137,2,152,0],[139,2,154,0],[140,0,155,0],[141,0,156,0],[142,2,157,7],[142,11,157,16,"getPauseStatus"],[142,25,157,30,"getPauseStatus"],[142,26,157,30],[142,28,157,33],[143,4,158,2],[143,8,158,6],[143,9,158,7,"pauseState"],[143,19,158,17],[143,21,158,19],[143,28,158,26],[143,32,158,30],[144,4,160,2],[144,10,160,8,"elapsed"],[144,17,160,15],[144,20,160,18,"Date"],[144,24,160,22],[144,25,160,23,"now"],[144,28,160,26],[144,29,160,27],[144,30,160,28],[144,33,160,31,"pauseState"],[144,43,160,41],[144,44,160,42,"pausedAt"],[144,52,160,50],[145,4,161,2],[145,10,161,8,"remaining"],[145,19,161,17],[145,22,161,20,"PAUSE_TIMEOUT_MS"],[145,38,161,36],[145,41,161,39,"elapsed"],[145,48,161,46],[146,4,163,2],[146,11,163,9],[147,6,164,4,"isPaused"],[147,14,164,12],[147,16,164,14],[147,20,164,18],[148,6,165,4,"elapsedMs"],[148,15,165,13],[148,17,165,15,"elapsed"],[148,24,165,22],[149,6,166,4,"remainingMs"],[149,17,166,15],[149,19,166,17,"Math"],[149,23,166,21],[149,24,166,22,"max"],[149,27,166,25],[149,28,166,26],[149,29,166,27],[149,31,166,29,"remaining"],[149,40,166,38],[149,41,166,39],[150,6,167,4,"remainingMinutes"],[150,22,167,20],[150,24,167,22,"Math"],[150,28,167,26],[150,29,167,27,"ceil"],[150,33,167,31],[150,34,167,32,"remaining"],[150,43,167,41],[150,46,167,44],[150,51,167,49],[151,4,168,2],[151,5,168,3],[152,2,169,0],[153,0,169,1],[153,3]],"functionMap":{"names":["<global>","initializeStreamMonitoring","handleAppStateChange","<anonymous>","pauseStream","setTimeout$argument_0","resumeStream","endStreamDueToPause","getPauseStatus"],"mappings":"AAA;OCgB;+BCM;GDU;SEM;GFQ;CDC;AIK;iCCgB;KDI;CJU;AMK;CNgC;AOK;CP2B;OQK;CRY"},"hasCjsExports":false},"type":"js/module"}]}